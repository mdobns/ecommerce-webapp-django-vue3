{% extends 'base.html' %}
{% block title %}Cart | {% endblock %}
{% block content %}
<div id="cartapp" class="max-w-4xl mx-auto bg-gray-900 rounded-2xl shadow-lg p-8 text-gray-200">
    
    <!-- Page Title -->
    <h1 class="text-3xl font-bold text-white mb-6">üõí Your Cart</h1>

{% if cart %}
<div class="overflow-x-auto">
    <table class="min-w-full divide-y divide-gray-700">
        <thead class="bg-gray-800">
            <tr>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Product</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Quantity</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Price</th>
                <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Action</th>
            </tr>
        </thead>
        <tbody class="bg-gray-900 divide-y divide-gray-700">
            {% for item in cart %}
            {% with product=item.product %}
            <tr>
                <td class="px-6 py-4 whitespace-nowrap">{{ product.title }}</td>
                <td class="px-6 py-4 whitespace-nowrap">{{ item.quantity }}</td>
                <td class="px-6 py-4 whitespace-nowrap">{{ item.total_price }}‡ß≥</td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <button @click="removeFromCart({{ product.id }})"
                            class="px-4 py-2 bg-gradient-to-r from-red-500 to-pink-600 text-white rounded-lg shadow-md hover:scale-105 transform transition">
                        ‚ùå Remove
                    </button>
                </td>
            </tr>
            {% endwith %}
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<p class="text-gray-400 text-lg">Your cart is empty!</p>
{% endif %}

</div>
{% endblock %}

{% block script %}
<script>
const productapp = Vue.createApp({
    delimiters: ['[[', ']]'],
    data() {
        return {}
    },
    mounted() {
        console.log("Mounted")
    },
    methods: {
        removeFromCart(product_id) {
            console.log('product_id:', product_id)

            var data = {
                'product_id': product_id,
            }

            fetch('/api/remove_from_cart/', {   
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': '{{ csrf_token }}'   
                },
                credentials: 'same-origin',  
                body: JSON.stringify(data)   
            })
            .then(response => {
                console.log(response)
            })
            .catch(error => {
                console.error('Error:', error)
            })
        }
    }
})
productapp.mount("#cartapp")
</script>
{% endblock %}
